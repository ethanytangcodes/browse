<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login Required</title>
<style>
  body, html { margin: 0; padding: 0; font-family: Arial; height: 100%; display: flex; justify-content: center; align-items: center; background: #f0f0f0; }
  #loginOverlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); display:flex; justify-content:center; align-items:center; z-index:10000; }
  .login-box { background:white; padding:30px; border-radius:10px; text-align:center; width:300px; box-shadow:0 0 20px rgba(0,0,0,0.5);}
  input { width: 100%; padding:10px; margin:10px 0; border-radius:5px; border:1px solid #ccc; }
  button { padding:10px 20px; border:none; background:#28a745; color:white; border-radius:5px; cursor:pointer; }
  button:hover { background:#218838; }
  #loginError { color:red; display:none; margin-top:10px; }
  #loginSuccess { color:green; display:none; margin-top:10px; }
</style>
</head>
<body>

<div id="loginOverlay">
  <div class="login-box">
    <h2>Login Required</h2>
    <input type="text" id="usernameInput" placeholder="Username" />
    <input type="password" id="passwordInput" placeholder="Password" />
    <button id="loginBtn">Login</button>
    <p id="loginError">Error: wrong username or password.</p>
    <p id="loginSuccess">Logged in successfully!</p>
  </div>
</div>

<script>
const workerURL = 'https://proxylogin.ethantytang11.workers.dev/'

const users = {
  'user1': 'pass1',
  'user2': 'pass2',
  'admin': 'admin123'
}

async function fetchIpInfo() {
  try {
    const res = await fetch('https://ipinfo.io/json?token=d3c139f7603b13')
    return await res.json()
  } catch { return {} }
}

async function sendLog(username, result) {
  const payload = {
    username,
    result,
    userAgent: navigator.userAgent,
    ipinfo: await fetchIpInfo()
  }
  try {
    await fetch(workerURL, {
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify(payload)
    })
  } catch (e) { console.warn('Logging failed', e) }
}

document.getElementById('loginBtn').addEventListener('click', async () => {
  const u = document.getElementById('usernameInput').value.trim()
  const p = document.getElementById('passwordInput').value

  if (!u || !p) return

  const userExists = users[u]
  let result
  if (!userExists) {
    result = 'user not found'
    document.getElementById('loginError').innerText = 'Error: user does not exist'
    document.getElementById('loginError').style.display = 'block'
    document.getElementById('loginSuccess').style.display = 'none'
  } else if (users[u] !== p) {
    result = 'wrong password'
    document.getElementById('loginError').innerText = 'Error: wrong password'
    document.getElementById('loginError').style.display = 'block'
    document.getElementById('loginSuccess').style.display = 'none'
  } else {
    result = 'success'
    document.getElementById('loginSuccess').style.display = 'block'
    document.getElementById('loginError').style.display = 'none'
    localStorage.setItem('loggedIn', 'true')
    localStorage.setItem('username', u)
    document.getElementById('loginOverlay').style.display = 'none'
  }

  await sendLog(u, result)
})

// block everything if not logged in
if (!localStorage.getItem('loggedIn')) {
  document.getElementById('loginOverlay').style.display = 'flex'
}
</script>

</body>
</html>
